}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,2000))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
contabilidad<- calculos.contabilidad(data=gastos, persona="ignacio", mes="01/2021", income=1000)
View(contabilidad[[1]])
x11()
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,2000))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,income))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,income))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
contabilidad<- calculos.contabilidad(data=gastos, persona="ignacio", mes="01/2021", income=1000)
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,2000))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
contabilidad<- calculos.contabilidad(data=gastos, persona="ignacio", mes="01/2021", income=1000)
View(contabilidad[[1]])
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = income, colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
contabilidad<- calculos.contabilidad(data=gastos, persona="ignacio", mes="01/2021", income=1000)
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
gastos
calculos.contabilidad<- function(data,persona=c("casa", "ignacio"), mes=NULL, income=1100){
gastos<-data
if(persona=="ignacio"){gastos<-gastos[gastos$CUENTA=="IGNACIO",]}else{gastos<-gastos[gastos$CUENTA=="CASA",]}
if(!is.null(mes)){gastos<- gastos[stri_sub(gastos$DÍA, -7, -1)==mes,]}
tabla.res<- aggregate(gastos$CANTIDAD, by=list(gastos$CATEGORÍA), FUN=sum)
colnames(tabla.res)[1]<-"TIENDA"
colnames(tabla.res)[2]<-"GASTO"#gastos por meses y tabla resumen
p2<-    ggplot(gastos)+
geom_bar(aes(DÍA, CANTIDAD, fill=CATEGORÍA),position="stack", stat="identity")+
labs(title = "EVOLUCIÓN DE GASTOS")+
scale_fill_brewer(palette = "Dark2")+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
axis.text.x = element_text(face="bold", size=8, hjust = 0.5),
legend.position = "none")
p1<-ggplot(tabla.res)+
geom_col(aes(x=0, y=GASTO, fill=paste0(TIENDA,":  ", GASTO, " \U20AC")))+
coord_polar(theta = "y")+
scale_x_continuous(breaks=NULL)+
xlab(NULL)+
ylab(NULL)+
labs(title = "PROPORCIÓN DE GASTOS", fill="TIENDA")+
scale_fill_brewer(palette = "Dark2")+
geom_text(aes(x=0.3, y = sum(GASTO)-(cumsum(GASTO) - GASTO/2), label=substr(TIENDA, 1,3)))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
axis.text = element_blank(),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
legend.position = "left"  )
if(sum(gastos$CANTIDAD)<income){
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=income), fill="#2FAD2F")+
scale_x_discrete()+
geom_col(aes(x=1, y=(CANTIDAD)), fill="#CA3434")+
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("AHORRO: ","\n", income-(sum(gastos$CANTIDAD)), "  \U20AC" ))+
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = sum(gastos$CANTIDAD), colour="red", lwd=2, lty=2)
}else{
p3<-ggplot(gastos)+
geom_col(aes(x=1, y=CANTIDAD), fill="black")+
scale_x_discrete()+
geom_col(aes(x=1, y=income), fill="#CA3434")+     #350*3 es el mínimo!
scale_y_continuous(limits = c(0,income+100))+
labs(title = paste0("SOBREGASTO: ","\n", (sum(gastos$CANTIDAD))-income, "  \U20AC" ))+ #350+360+390 es el mínimo!
theme(
plot.title = element_text(face="bold", size=14, hjust = 0.5),
panel.background = element_rect(fill = "transparent", color = NA),
plot.background  = element_rect(fill = "transparent", color = NA),
axis.title.x = element_blank(),
axis.title.y = element_blank()
)+
geom_hline(yintercept = sum(gastos$CANTIDAD), colour="red", lwd=2, lty=2)
}
return(list(gastos, p1, p2, p3))
}
contabilidad<- calculos.contabilidad(data=gastos, persona="ignacio", mes="01/2021", income=1000)
grid.arrange(contabilidad[[2]], contabilidad[[3]], contabilidad[[4]],
widths = c(2, 1, 1),
layout_matrix = rbind(c(1, 1, 2),
c(1, 1, 3)))
gastos<-gsheet2tbl('https://docs.google.com/spreadsheets/d/1pUJv3WacwNaGQZM20gRwCL8LrArmLHEXKmuDRrkWrg8/edit#gid=249967951')
View(gastos)
load("H:/MIERDA BORRABLE/Tree_example.RData")
x11()
plot(Tree)
library(phytools)
plot(Tree)
nodelabels(cex=0.75)
Lista <- list(c("sp1","sp2","sp3","sp4","sp5"),c("sp19","sp20","sp21","sp22","sp23"))
DF <- data.frame(Tree$edge,1:dim(Tree$edge)[1],Tree$edge.length) # La tercera columna de esta table es un identificador numérico específico de cada
colnames(DF) <- c("Parent Node","Child Node","Edge ID","Edge Length")
Lista_Edge <- vector(mode="list",length=length(Lista)) # En esta lista voy a almacenar la identidad de las ramas prohibidas
Lista_Edge
for (i in 1:length(Lista)) {
Grupo <- Lista[[i]]  # Saco el grupo correspondiente
ID_tip <- NA
for(k in 1:length(Grupo)) {
ID_tip <- c(ID_tip,which(Tree$tip.label==Grupo[k])) # Números que R asigna a las especies
}
ID_tip <- ID_tip[-1]
KK_Pare_tip <- NA
for(j in 1:length(ID_tip)) {  # Con este bucle voy a identificar las ramas terminales del grupo, así como la identidad de los nodos internos a partir de los cuales vamos a extraer los identificadores de las ramas prohibidas en la aleatorización
KK_Pare_tip <- c(KK_Pare_tip,getParent(Tree, ID_tip[j]))
}
KK_Pare_tip <- unique(KK_Pare_tip[-1])
Lista_Edge[[i]] <- DF[DF[,2] <= max(KK_Pare_tip) & DF[,2] > getMRCA(Tree,ID_tip) | DF[,2] %in% ID_tip,3] # Si borras el "3" de la línea de código, verás que el trozo de DF que incluye las ramas prohibidas del grupo correspondiente
}
Lista_Edge
Grupo
ID_tip
Lista_Edge
Lista_Edge <- vector(mode="list",length=length(Lista)) # En esta lista voy a almacenar la identidad de las ramas prohibidas
Lista_Edge
Lista
0.75*3.141592*(0.9)^3
library(openxlsx)
afliber<- read.xlsx("E:/UNI/4. DOCTORADO/1. AFLIBER/archivos/AFLIBER_Checklist.csv")
afliber<- read.csv("E:/UNI/4. DOCTORADO/1. AFLIBER/archivos/AFLIBER_Checklist.csv")
View(afliber)
